<!doctype html>
<html>
<head>
	<title>Profile Viewer</title>
	<style>
.frame {
	position: absolute;
	display: inline-block;
	border: 2px solid black;
	height: 2em;
	top: 100%;
	padding: 0px;
	margin: 0;
	margin-left: -2px;
}

body {
	position: relative;
	width: 100%;
}

.info:active {
	position: relative;
	color: #DDD;
	font-weight: bold;
	overflow: visible !important;
	text-shadow: 1px 1px black;
	z-index: 100;
}

	</style>
</head>
<body>

<script type="text/javascript">

"use strict";
let data = undefined;
function profiledata(fresh) {
	data = fresh;
	data.name = "<root>";
}

</script>

<script src="profiled.js"></script>

<script type="text/javascript">

"use strict";

function palette(n) {
	let out = [];
	for (let i = 0; i < n; i++) {
		let hue = 360 / n * i;
		out.push("hsl(" + hue + ", 90%, 50%)");
	}
	return out;
}

function showNode(data) {
	let row = document.createElement("div");
	row.className = "frame";

	let children = [];
	let total = 0;
	for (let key in data) {
		let object = data[key];
		if (typeof object === typeof {} && !(object instanceof Array)) {
			object.name = JSON.stringify(object.aliases) + key; // TODO: use aliases!
			children.push(object);
			total = total + object.clock;
		}
	}
	children.sort(function(a, b) {
		return b.clock - a.clock;
	});

	let colors = palette(children.length);
	let x = 0;
	let index = 0;
	for (let child of children) {
		let color = colors[index];
		index++;

		let div = showNode(child);
		let size = (child.clock / total * 100);

		div.style.width = size + "%";
		div.style.left = x + "%";
		div.style.background = color;

		x += size;
		row.appendChild(div);
	}

	let marquee = document.createElement("div");
	marquee.className = "info";
	marquee.textContent = data.name + "; Time: " + data.clock.toFixed(4) + "s; Count: " + data.count;
	marquee.style.overflow = "hidden";
	marquee.style.left = 0;
	marquee.style.right = 0;
	marquee.style.top = 0;
	marquee.style.position = "absolute";
	marquee.style.height = "2em";
	//row.style.overflowY = "visible";
	row.appendChild(marquee);

	return row;
}

let whole = showNode(data);
document.body.appendChild(whole);
whole.style.left = "10%";
whole.style.right = "10%";

</script>
